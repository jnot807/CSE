<!DOCTYPE HTML>
<html>
<head>
  <title>Multiverse + Custom Search Tools</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="assets/css/main.css" />
  <style>
    html, body {
      background-color: #0f0f0f;
      color: #fff;
      font-family: sans-serif;
    }
    h2, p { color: #fff; }
    .scraper-badge { display: flex; justify-content: center; margin: 2rem auto; }
    .scraper-badge a { display: flex; align-items: center; gap: 12px; padding: 12px 20px;
      border-radius: 8px; background: #1f1f1f; box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      text-decoration: none; color: #fff; max-width: 600px; }
    .scraper-badge img { height: 40px; }
    .scraper-badge span { font-size: .9rem; line-height: 1.4; }
    .scraper-badge strong { display: block; font-weight: bold; }
    .card { background-color: #1a1a1a; border-radius: 12px; padding: 2rem;
      margin: 2rem auto; box-shadow: 0 4px 20px rgba(255,255,255,0.05); max-width: 900px; }
    .button-group { display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; }
    .button-group .button { min-width: 250px; }
    .search-container .gcse-search { min-height: 600px; }
    iframe { display: block; width: 100%; height: 800px; border: 1px solid #333; margin-top: 2rem; }
    a.button { background: #111; color: #fff !important; border: 1px solid #444;
      border-radius: 8px; padding: .8em 1.5em; transition: background .3s; }
    a.button:hover { background: #333; }

    /* JSON API Combined Search styling */
    .json-search-box { background: #1a1a1a; padding: 1.5rem; border-radius:12px;
      display: flex; flex-direction: column; gap:1rem; }
    .json-search-box input, .json-search-box button {
      padding: .8rem; border-radius: 8px; border: none; font-size:1rem;
      background: #2a2a2a; color: white; }
    .json-search-box button { background: #333; cursor:pointer; }
    button:disabled { opacity:.5; cursor:not-allowed; }
    .country-tabs { display:flex; flex-wrap:wrap; gap:8px; margin-top: .5rem; }
    .country-tab { background:#2a2a2a; padding:.5rem .8rem; border-radius:6px; cursor:pointer; }
    .country-tab.active { background:#4ac3ff; color:black; }

    #jsonResults ul { list-style:none; padding-left:0; }
    #jsonResults li { margin-bottom:1rem; }
    #jsonResults a { color:#4ac3ff; text-decoration:none; }
    #jsonResults a:hover { text-decoration:underline; }
  </style>
</head>
<body>

  <!-- Instant Data Scraper Badge -->
  <div class="scraper-badge">
    <a href="https://chromewebstore.google.com/detail/instant-data-scraper/ofaokhiedipichpaobibbnahnkdoiiah" target="_blank">
      <img src="assets/images/Screenshot 2025-07-17 at 15.13.03.png" alt="Instant Data Scraper">
      <span>
        Want to scrape/save results?<br><strong>Download the Instant Data Scraper Extension</strong>
      </span>
    </a>
  </div>

  <section id="search-tools" class="wrapper style1">
    <div class="card">
      <header class="major" style="text-align:center;">
        <h2>Custom Search Portal</h2>
        <p>Select a tool to begin</p>
      </header>

      <div class="button-group">
        <a href="#" class="button primary" onclick="loadCSE('f1d198890af1d469b')">üåç Country Specific Search</a>
        <a href="#" class="button" onclick="loadCompetitorJSON()">üìä Competitor Search</a>
        <a href="#" class="button" onclick="loadExternal('gendersort')">üß† GenderSort Tool</a>
        <a href="#" class="button" onclick="loadCombinedJSON()">üåê Country + Competitor Combined Search (API Key)</a>
      </div>

      <div class="search-container" id="searchContainer"></div>
    </div>
  </section>

<script>
  // Load Country-Specific CSE
  function loadCSE(cxId) {
    const c = document.getElementById("searchContainer");
    c.innerHTML = '';
    const s = document.createElement("script");
    s.src = "https://cse.google.com/cse.js?cx=" + cxId; s.async = true;
    c.appendChild(s);
    const d = document.createElement("div"); d.className = "gcse-search";
    c.appendChild(d);
  }

  // Load GenderSort
  function loadExternal(tool) {
    const c = document.getElementById("searchContainer");
    c.innerHTML = '';
    if (tool === 'gendersort') {
      const iframe = document.createElement("iframe");
      iframe.src = "https://gendersort.onrender.com";
      c.appendChild(iframe);
    }
  }

  // Simple JSON Competitor Search
  function loadCompetitorJSON() {
    const c = document.getElementById("searchContainer");
    c.innerHTML = `
      <div class="json-search-box">
        <input type="text" id="query" placeholder="Search for a company, recruiter, etc..." />
        <button onclick="runSearchSimple()">Search</button>
      </div>
      <div class="results" id="results"></div>`;
  }

  async function runSearchSimple() {
    const API_KEY = 'AIzaSyDEEQi0TYf-2ULYA0G2Q6x1JHWH4NUrok8';
    const CX = '6742cda52f2e045d2';
    const q = document.getElementById('query').value.trim();
    const out = document.getElementById('results');
    out.innerHTML = 'üîç Searching...';
    if (!q) { out.innerHTML = '<p>Please enter a search term.</p>'; return; }
    try {
      const r = await fetch(`https://www.googleapis.com/customsearch/v1?key=${API_KEY}&cx=${CX}&q=${encodeURIComponent(q)}`);
      const data = await r.json();
      if (!data.items) { out.innerHTML = 'No results found.'; return; }
      out.innerHTML = '';
      data.items.forEach(item => {
        const div = document.createElement('div');
        div.className = 'result-item';
        div.innerHTML = `<a href="${item.link}" target="_blank">${item.title}</a><p>${item.snippet}</p>`;
        out.appendChild(div);
      });
    } catch (e) {
      out.innerHTML = '<p style="color:red;">Error fetching results.</p>'; console.error(e);
    }
  }

  // Combined JSON (Country + Competitor) Search
  function loadCombinedJSON() {
    const c = document.getElementById("searchContainer");
    c.innerHTML = `
      <div class="json-search-box">
        <input type="text" id="queryInput" placeholder="Enter keywords (e.g. data engineer)" />
        <input type="text" id="company" placeholder="Enter company name (e.g. Nestl√©)" />
        <div class="country-tabs" id="countryTabs"></div>
        <button onclick="runCompetitorSearch()">Search</button>
        <button id="saveBtn" disabled onclick="saveResults()">üíæ Save Results</button>
      </div>
      <div id="jsonResults"><ul></ul></div>`;
    initCombinedSearch();
  }

  // Country map + JSON infinite scroll logic
  function initCombinedSearch() {
    const API_KEY = 'AIzaSyDEEQi0TYf-2ULYA0G2Q6x1JHWH4NUrok8';
    const CX = '729f737642d434e00';
    let selectedSite = '', nextIndex = 1, fetching = false, finished = false, lastResults = [];

    const countries = { /* same country list omitted for brevity‚Ä¶ */ };
    const tabs = document.getElementById("countryTabs");
    Object.entries(countries).sort().forEach(([n,u])=>{
      const t = document.createElement('div');
      t.className='country-tab'; t.textContent=n;
      t.onclick=()=>{
        tabs.querySelectorAll('.country-tab').forEach(x=>x.classList.remove('active'));
        t.classList.add('active'); selectedSite = u;
      };
      tabs.appendChild(t);
    });

    window.scrollListener = async () => {
      if (finished || fetching) return;
      if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 200) {
        await fetchMore();
      }
    };
    window.addEventListener('scroll', window.scrollListener);

    window.runCompetitorSearch = async () => {
      document.getElementById("jsonResults").innerHTML = '<ul></ul>';
      document.getElementById("saveBtn").disabled = true;
      lastResults=[]; nextIndex=1; finished=false;
      await fetchMore();
    };

    async function fetchMore() {
      fetching = true;
      const q1 = document.getElementById('queryInput').value.trim();
      const comp = document.getElementById('company').value.trim();
      let q = '';
      if (selectedSite) q+=`site:${selectedSite} `;
      if (comp) q+=`intitle:"${comp}" `;
      if (q1) q+=q1;
      if (!q) { alert('Please enter query or filter'); fetching=false; return; }

      try {
        const res = await fetch(
          `https://www.googleapis.com/customsearch/v1?key=${API_KEY}&cx=${CX}&q=${encodeURIComponent(q)}&start=${nextIndex}`
        );
        const d = await res.json();
        const ul = document.querySelector('#jsonResults ul');
        if (d.items) {
          document.getElementById("saveBtn").disabled = false;
          d.items.forEach(it => {
            const li = document.createElement('li');
            li.innerHTML = `<a href="${it.link}" target="_blank">${it.title}</a><br>${it.snippet}`;
            ul.appendChild(li);
            lastResults.push({ title:it.title, link:it.link, snippet:it.snippet });
          });
          nextIndex += 10;
          if (!d.queries?.nextPage || nextIndex>100) finished=true;
        } else {
          if (nextIndex===1) ul.innerHTML='<li>No results found.</li>';
          finished=true;
        }
      } catch(e) {
        console.error(e);
        finished=true;
      }
      fetching=false;
    }

    window.saveResults = () => {
      if (!lastResults.length) return;
      let html = '<html><head><meta charset="utf-8"><title>Results</title></head><body>';
      html+= '<h2>Search Results</h2><table border="1" cellpadding="8"><tr><th>Title</th><th>Link</th><th>Snippet</th></tr>';
      lastResults.forEach(it => {
        html+=`<tr><td>${it.title}</td><td><a href="${it.link}">${it.link}</a></td><td>${it.snippet}</td></tr>`;
      });
      html+='</table></body></html>';
      const blob=new Blob([html],{type:'text/html'});
      const u=URL.createObjectURL(blob);
      const a=document.createElement('a');
      a.href=u; a.download='search_results.html';
      document.body.appendChild(a); a.click();
      document.body.removeChild(a);
    };
  }
</script>

<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/browser.min.js"></script>
<script src="assets/js/breakpoints.min.js"></script>
<script src="assets/js/util.js"></script>
<script src="assets/js/main.js"></script>
</body>
</html>
